<!DOCTYPE html>
<html>
  <head>
    <%- include('../part/head.ejs') %>
    <%- include('../part/bootstrapCSS.ejs') %>
  </head>
  <body class="on-loading">
    <%- include('../part/bootstrapJS.ejs') %>
    <script src="https://kit.fontawesome.com/071ea1fa85.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.1.1/dist/chart.min.js"></script>    
    <%- include('../part/loading.ejs') %>
    
    <%- include('../part/navbar.ejs') %>
    
    <main id="main" role="main" class="main" style="padding: 10px;">
<div class="wrapper">
  <div class="sidebar">
            <% let icon;
            if (guild.icon) {
            icon = `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.webp`
            } else if (!guild.icon) {
            icon = bot.user.displayAvatarURL()
            }
            %>    
    <div class="title"><img class="server-icon" src="<%= icon %>"> <%= guild.name %></div>
    <ul class="nav">
      <li class="sidebar-item">
        <a href="/dashboard/<%= guild.id %>/commands" class="a"><i class="fas fa-chart-bar"></i> Commands</a>
      </li>      
      <li class="sidebar-item">
        <a href="/dashboard/<%= guild.id %>/settings" class="a"><i class="fas fa-cog"></i> Settings</a>
      </li>      
      <li class="sidebar-item">
        <a href="/dashboard/<%= guild.id %>" class="a"><i class="fas fa-chart-bar"></i> Statistics</a>
      </li>
      <li class="sidebar-item">
        <a href="/dashboard/<%= guild.id %>/auto-mod" class="a"><i class="fas fa-ban"></i> Auto Mod</a>
      </li>
      <li class="sidebar-item">
        <a href="/dashboard/<%= guild.id %>/cc" class="a"><i class="fas fa-code"></i> Custom Commands</a>
      </li>
      <li class="sidebar-item">
        <a href="/dashboard/<%= guild.id %>/music-player" class="a"><i class="fas fa-music"></i> Music</a>
      </li>
    </ul>
  </div> 
  
  <% let disabled = [] 
  if (database.Settings.DisabledCommands[0]) {
  database.Settings.DisabledCommands.map(cmd => {
  disabled.push(cmd.name.toLowerCase());
  });
  }
  %>
  
  <div class="content content-is-open" style="height: auto;">
    <span class='side-panel-toggle'>
      <i class="fa fa-bars"></i>
    </span>
    <div class="module-list" onchange="save()">
      <form method="POST" id="formnya">
      <% bot.Modules.map(mod => { %>
      
      <% let cmds = []
      mod.commands.map(cmd => {
      if (disabled.includes(cmd.name.toLowerCase())) {
      cmds.push({cmd: cmd, disabled: true})
      } else if (!disabled.includes(cmd.name.toLowerCase())) {
      cmds.push({cmd: cmd, disabled: false})
      }
      });
      %>
<!--        -->
      <div class="module">
        <h1 class="module-name"><%= mod.name %></h1>
        
    <div class="db-cmdlist">
      <% cmds.map(cmd => { %>
      <div class="db-cmd <%= cmd.cmd.name === "help" ? "disabled" : "" %>">  
          <div class="db-cmd-first">
          <h3 class="db-cmd-name"><%= cmd.cmd.name.length > 9 ? cmd.cmd.name.substring(0, 6) + "..." : cmd.cmd.name %></h3>
            <% if (cmd.cmd.name === "help") { %>   
<label class="switch <%= cmd.cmd.name === "help" ? "disabled" : "" %>">
  <input class="<%= cmd.cmd.name === "help" ? "disabled" : "" %>" type="checkbox" name="<%= cmd.cmd.name %>" disabled checked>
  <span class="slider round <%= cmd.cmd.name === "help" ? "disabled" : "" %>"></span>
</label>            
            <% } else { %>
            <% if (!cmd.disabled) { %>
<label class="switch">
  <input type="checkbox" name="<%= cmd.cmd.name %>">
  <span class="slider round"></span>
</label>            
            <% } else if (cmd.disabled) { %>
<label class="switch">
  <input type="checkbox" name="<%= cmd.cmd.name %>" checked>
  <span class="slider round"></span>
</label>            
            <% } %>            
            <% } %>
          </div>
      </div>         
      <% }) %>
    </div>
        
        <hr>
      </div>
      
      <% }) %>            
        <div class="save-list">
          <a class="save-btn-item reset-btn" onclick="resetFORM()" style="text-align: right; margin-right: 24px; cursor: pointer;">Reset</a>
          <button class="btn btn-warning save-btn-item" id="thebtn" type="submit">Save</button>
        </div>
      </form>
    </div>
      <div class="navigation">  
        <a class="navigation-link" href="/commands?id=<%= guild.id %>" target="_blank">Go to commands list <i class="fas fa-external-link-alt"></i></a>
      </div>
  </div>
</div>
    </main>
    

    <%- include('../part/footer.ejs') %>
    <script>
      
      let form = $('#formnya')
      let TheForm = $('#thebtn')
      let resetBTN = $('.reset-btn')
      TheForm.hide()
      resetBTN.hide()
      
      async function save() {
      resetBTN.show(500)
      TheForm.show(600)
      }
      
      async function resetFORM() {
        form.trigger("reset");
        TheForm.hide();
        resetBTN.hide();
      }
      
$(window).resize(function() {
	var path = $(this);
	var contW = path.width();
	if(contW >= 769){
    $('.content').css('margin-left', '220px');
	}else{
    $('.content').css('margin-left', '0px');
	}
});

$(document).ready(function() {
	$(".side-panel-toggle").click(function(e) {
		e.preventDefault();
    var marginLeft = $('.content').css('margin-left');
    if (marginLeft === '220px') {
      $('.content').css('margin-left', '0px');
    } else {
      $('.content').css('margin-left', '220px');
    }
	});
});    
    </script>
  </body>
</html>